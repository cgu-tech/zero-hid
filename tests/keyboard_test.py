from zero_hid import Keyboard
from zero_hid.hid.mouse import send_mouse_event, MOUSE_BUTTON_LEFT, MOUSE_BUTTON_RIGHT, MOUSE_BUTTON_MIDDLE
from common import read_bytes, temp_path

def send_keyboard_event_data(dev, mods: List[int], keys: List[int]):
    with temp_path() as dev_path:
        with open(dev_path, "w+b") as dev:
            send_keyboard_event(dev, buttons, x, y, vertical_wheel_delta, horizontal_wheel_delta)
            dev.seek(0)
            data = dev.read()
    return data

# Test keyboard identity

def test_identity_report():
    data = send_keyboard_event_data([], 0, 0, 0, 0)
    assert data == b"\x02\x00\x00\x00\x00\x00\x00\x00"

def test_typing():
    with temp_path() as p:
        k = Keyboard(p)
        k.type("Hello world!")
        data = read_bytes(p)
    expect = b"\x02\x00\x0b\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00,\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x12\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x1e\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    assert expect == data


def test_release():
    with temp_path() as p:
        k = Keyboard(p)
        k.release()
        data = read_bytes(p)

    assert b"\x00\x00\x00\x00\x00\x00\x00\x00" == data
